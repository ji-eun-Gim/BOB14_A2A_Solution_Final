<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>A2A Security Dashboard - 로그</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css"
    />
    <link rel="stylesheet" href="../style.css" />
    <link rel="stylesheet" href="/logs/style.css" />
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://npmcdn.com/flatpickr/dist/l10n/ko.js"></script>
    <script src="/logs/logs.js" defer></script>
  </head>
  <body>
    <div class="app-container" data-page="logs">
      <header class="app-header">
        <div class="logo">A2A SECURE</div>
        <nav class="main-nav">
          <a href="/dashboard" class="nav-link">대시보드</a>
          <a href="/agents" class="nav-link">에이전트</a>
          <a href="/logs" class="nav-link active">로그</a>
          <a href="/rulesets" class="nav-link">룰셋</a>
        </nav>
      </header>

      <main class="content-area">
        <div class="content-wrapper">
          <section id="logs" class="content-page active">
            <div class="main-tabs">
              <button class="main-tab-btn active" data-target="view-agent">
                🛡️ 에이전트 로그
              </button>
              <button class="main-tab-btn" data-target="view-registry">
                ⚙️ 레지스트리 로그
              </button>
              <div class="tab-spacer"></div>
            </div>

            <div id="view-agent" class="tab-view active">
              <article class="widget filter-widget">
                <div class="filters-wrapper">
                  <div class="filter-group">
                    <label>기간 설정</label>
                    <div class="date-range">
                      <input
                        type="text"
                        id="agent-date-start"
                        class="input-dark flatpickr-input"
                        placeholder="시작"
                      />
                      <span>~</span>
                      <input
                        type="text"
                        id="agent-date-end"
                        class="input-dark flatpickr-input"
                        placeholder="종료"
                      />
                    </div>
                  </div>

                  <div class="filter-group">
                    <label>에이전트</label>
                    <div class="dropdown-wrapper" id="dropdown-agent">
                      <div class="dropdown-btn">전체 선택</div>
                      <div class="dropdown-list"></div>
                    </div>
                  </div>

                  <div class="filter-group">
                    <label>툴 (Tool)</label>
                    <div class="dropdown-wrapper disabled" id="dropdown-tool">
                      <div class="dropdown-btn">에이전트 선택 필요</div>
                      <div class="dropdown-list"></div>
                    </div>
                  </div>

                  <div class="filter-group">
                    <label>정책 유형</label>
                    <div class="dropdown-wrapper" id="dropdown-policy">
                      <div class="dropdown-btn" style="color: #94a3b8">
                        선택 안 함
                      </div>
                      <div class="dropdown-list">
                        <label class="dropdown-item">
                          <input type="checkbox" value="에이전트 접근" />
                          에이전트 접근
                        </label>
                        <label class="dropdown-item">
                          <input type="checkbox" value="툴 접근" /> 툴 접근
                        </label>
                      </div>
                    </div>
                  </div>

                  <div class="filter-group search-group">
                    <label>키워드 검색</label>
                    <div class="search-row">
                      <input
                        type="search"
                        id="agent-search"
                        class="input-dark"
                        placeholder="유저명, 메시지 검색"
                        autocomplete="off"
                      />
                      <button id="agent-search-btn" class="btn-secondary small">
                        🔍 검색
                      </button>
                      <button
                        id="agent-filter-reset"
                        class="btn-secondary small"
                      >
                        필터 초기화
                      </button>
                    </div>
                  </div>
                </div>
              </article>

              <article class="widget table-widget">
                <div class="widget-header-simple">
                  <span class="count-badge" id="agent-count">0건</span>
                  <button class="btn-secondary small" id="refresh-logs">
                    🔄 새로고침
                  </button>
                </div>
                <table class="log-table">
                  <thead class="text-center">
                    <tr>
                      <th style="width: 200px">시간</th>
                      <th style="width: 250px">에이전트/툴</th>
                      <th style="width: 150px">정책 유형</th>
                      <th>메시지 (접근 시도 내역)</th>
                      <th style="width: 80px"></th>
                    </tr>
                  </thead>
                  <tbody id="tbody-agent"></tbody>
                </table>
              </article>
            </div>

            <div id="view-registry" class="tab-view hidden">
              <article class="widget filter-widget">
                <div class="filters-wrapper">
                  <div class="filter-group">
                    <label>기간 설정</label>
                    <div class="date-range">
                      <input
                        type="text"
                        id="registry-date-start"
                        class="input-dark flatpickr-input"
                        placeholder="시작"
                      />
                      <span>~</span>
                      <input
                        type="text"
                        id="registry-date-end"
                        class="input-dark flatpickr-input"
                        placeholder="종료"
                      />
                    </div>
                  </div>

                  <div class="filter-group">
                    <label>동작 (Operation)</label>
                    <div class="dropdown-wrapper" id="dropdown-reg-op">
                      <div class="dropdown-btn">전체 선택</div>
                      <div class="dropdown-list"></div>
                    </div>
                  </div>

                  <div class="filter-group">
                    <label>상태 코드</label>
                    <div class="dropdown-wrapper" id="dropdown-reg-status">
                      <div class="dropdown-btn">전체 선택</div>
                      <div class="dropdown-list"></div>
                    </div>
                  </div>

                  <div class="filter-group">
                    <label>검증 단계</label>
                    <div class="dropdown-wrapper" id="dropdown-reg-stage">
                      <div class="dropdown-btn">전체 선택</div>
                      <div class="dropdown-list"></div>
                    </div>
                  </div>

                  <div class="filter-group search-group">
                    <label>키워드 검색</label>
                    <div class="search-row">
                      <input
                        type="search"
                        id="registry-search"
                        class="input-dark"
                        placeholder="요청자, 메시지 검색"
                        autocomplete="off"
                      />
                      <button
                        id="registry-search-btn"
                        class="btn-secondary small"
                      >
                        🔍 검색
                      </button>
                      <button
                        id="registry-filter-reset"
                        class="btn-secondary small"
                      >
                        필터 초기화
                      </button>
                    </div>
                  </div>
                </div>
              </article>

              <article class="widget table-widget">
                <div class="widget-header-simple">
                  <span class="count-badge" id="registry-count">0건</span>
                  <button class="btn-secondary small" id="refresh-registry">
                    🔄 새로고침
                  </button>
                </div>
                <table class="log-table">
                  <thead class="text-center">
                    <tr>
                      <th style="width: 180px">시간</th>
                      <th style="width: 150px">요청자</th>
                      <th style="width: 100px">동작</th>
                      <th style="width: 100px">상태 코드</th>
                      <th style="width: 180px">검증 단계</th>
                      <th>메시지 (상세 사유)</th>
                      <th style="width: 80px"></th>
                    </tr>
                  </thead>
                  <tbody id="tbody-registry"></tbody>
                </table>
              </article>
            </div>
            <template id="tmpl-registry-row">
              <tr>
                <td class="col-time"></td>
                <td class="col-actor text-center"></td>
                <td class="col-method text-center"></td>
                <td class="col-status text-center"></td>
                <td class="col-stage text-center"></td>
                <td class="col-msg"></td>
                <td class="text-right">
                  <button class="btn-secondary btn-small">상세</button>
                </td>
              </tr>
            </template>
          </section>
        </div>
      </main>
    </div>

    <template id="tmpl-agent-row">
      <tr>
        <td class="col-time"></td>
        <td class="col-agent"></td>
        <td class="col-policy"></td>
        <td class="col-msg"></td>
        <td class="text-right">
          <button class="btn-secondary btn-small">상세</button>
        </td>
      </tr>
    </template>
    <div class="modal-overlay hidden" id="log-modal">
      <div class="modal">
        <div class="modal-header">
          <h3>상세 정보</h3>
        </div>

        <div class="modal-content">
          <pre id="modal-json"></pre>
        </div>

        <div class="modal-footer">
          <button id="close-modal" class="btn-secondary">닫기</button>
        </div>
      </div>
    </div>
  </body>
</html>
